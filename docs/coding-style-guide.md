# Руководство по стилю кодирования проекта UniFarm

## Общие принципы

1. **Следование SOLID-принципам**
   - Каждый модуль имеет единственную ответственность (Single Responsibility)
   - Сервисы должны быть расширяемыми без изменения существующего кода (Open-Closed)
   - Применение интерфейсов для определения контрактов (Interface Segregation)
   - Зависимости должны внедряться через параметры функций или конструкторы (Dependency Inversion)

2. **Архитектура проекта**
   - **Контроллеры**: отвечают за обработку HTTP-запросов, валидацию входных данных и формирование ответов
   - **Сервисы**: содержат бизнес-логику и являются независимыми от контроллеров
   - **Хранилище**: взаимодействует с базой данных и предоставляет интерфейс для сервисов
   - **Модели**: определяют структуру данных и их валидацию
   - **Утилиты**: содержат вспомогательные функции, используемые в разных модулях

3. **Паттерны проектирования**
   - Service/Instance: сервисы представлены в виде класса с экземпляром и прокси-модуля
   - Repository/Storage: доступ к данным через интерфейс хранилища
   - Middleware: для обработки запросов к API

## Стандарты кодирования

1. **Именование файлов и папок**
   - Используйте camelCase для имен файлов контроллеров: `userController.ts`
   - Используйте kebab-case для имен файлов утилит: `response-utils.ts`
   - Используйте kebab-case для имен файлов API-маршрутов: `user-routes.ts`
   - Имена контроллеров должны содержать суффикс `Controller`
   - Имена сервисов должны содержать суффикс `Service` или `ServiceInstance`
   - Имена интерфейсов должны начинаться с "I": `IStorage`, `IAuthService`

2. **Именование переменных и функций**
   - Используйте camelCase для имен переменных и функций: `getUserById`, `totalAmount`
   - Используйте PascalCase для имен классов, интерфейсов и типов: `UserController`, `TransactionType`
   - Используйте UPPER_SNAKE_CASE для констант: `MAX_RETRIES`, `DEFAULT_TIMEOUT`
   - Префиксы для булевых переменных: `is`, `has`, `should`: `isActive`, `hasPermission`
   - Префиксы для асинхронных функций: `async`, все промисы должны иметь тип `Promise<T>`

3. **Оформление кода**
   - Отступы: 2 пробела
   - Максимальная длина строки: 100 символов
   - Используйте одинарные кавычки для строковых литералов: `'string'`
   - Используйте точку с запятой в конце каждого выражения
   - Используйте фигурные скобки для всех блоков, даже если они состоят из одной строки

4. **Комментарии и документация**
   - Используйте JSDoc для документирования функций и методов
   - Для каждого модуля должен быть заголовочный комментарий с описанием его назначения
   - Используйте однострочные комментарии для пояснения сложной логики
   - Избегайте закомментированного кода в продакшене

## Обработка ошибок и логирование

1. **Стандарты обработки ошибок**
   - Используйте классы ошибок для разных типов ошибок: `ValidationError`, `NotFoundError`
   - Всегда обрабатывайте ошибки асинхронных функций с помощью try/catch
   - Используйте централизованный обработчик ошибок для API-запросов

2. **Логирование**
   - Используйте префиксы для логов: `[DB]`, `[API]`, `[AUTH]`
   - Логируйте все критические операции и ошибки
   - Используйте разные уровни логирования: error, warn, info, debug
   - Структурируйте логи в едином формате: время, уровень, модуль, сообщение

## Работа с базой данных

1. **Запросы к базе данных**
   - Используйте параметризованные запросы для защиты от SQL-инъекций
   - Обрабатывайте все ошибки соединения с базой данных
   - Используйте транзакции для атомарных операций

2. **Схемы и модели**
   - Используйте Drizzle ORM для определения схем таблиц
   - Используйте Zod для валидации данных
   - Определяйте типы для всех моделей: `InsertUser`, `User`, `Transaction`

## API и контракты

1. **Структура API-ответов**
   - Стандартный формат ответа: `{ success: boolean, data?: any, error?: any }`
   - Используйте HTTP-коды состояния соответствующим образом

2. **Валидация входных данных**
   - Всегда валидируйте входные данные с помощью Zod
   - Отправляйте подробные сообщения об ошибках валидации

## Тестирование

1. **Модульные тесты**
   - Тестируйте сервисы и утилиты изолированно
   - Используйте моки для внешних зависимостей

2. **Интеграционные тесты**
   - Тестируйте взаимодействие между модулями
   - Тестируйте API-маршруты с помощью Supertest

## Производительность и безопасность

1. **Производительность**
   - Оптимизируйте запросы к базе данных
   - Используйте кэширование для часто запрашиваемых данных
   - Применяйте техники пагинации для больших наборов данных

2. **Безопасность**
   - Валидируйте все внешние данные
   - Защищайтесь от инъекций и XSS-атак
   - Используйте безопасные функции для работы с криптографией
