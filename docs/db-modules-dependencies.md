# Карта взаимосвязей модулей базы данных

## Основные модули

1. **db.ts** - Точка входа, реэкспортирует компоненты из db-selector.ts
2. **db-selector.ts** - Определяет тип базы данных (Neon или Replit) и создает соответствующее подключение
3. **db-connect.ts** - Основной модуль подключения с функциями восстановления соединения
4. **db-health.ts** - Модуль для мониторинга состояния подключения
5. **db-monitor.ts** - Класс мониторинга, использующий функции из других модулей

## Циклические зависимости

- **db-connect.ts** -> **db-health.ts** -> **db-connect.ts**
  - `db-connect.ts` импортирует `dbHealth` из `db-health.ts`
  - `db-health.ts` импортирует `getDbConfig` из `db-connect.ts`

## Другие выявленные проблемы

1. Дублирование функциональности между `db-health.ts` и `db-monitor.ts`
   - Оба модуля отслеживают состояние соединения
   - Оба содержат функции для проверки соединения и переподключения
   - Оба накапливают статистику мониторинга

2. Множество устаревших файлов с похожей функциональностью:
   - db-alt.ts
   - db-neon.ts
   - db-override.ts
   - db-replit.ts
   - db-standard.ts
   - db-selector-new.ts

## Рекомендации по исправлению

1. Разделить ответственность между модулями:
   - **db-config.ts** - Конфигурация подключения
   - **db-connect.ts** - Создание и управление подключением
   - **db-monitor.ts** - Мониторинг состояния и статистика
   - **db.ts** - Точка входа, экспортирующая необходимые компоненты

2. Устранить циклические зависимости путем выделения общей функциональности в отдельный модуль
