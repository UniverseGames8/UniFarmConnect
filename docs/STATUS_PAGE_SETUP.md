# Настройка страницы статуса UniFarm

В этом документе описывается процесс настройки и использования страницы статуса для мониторинга приложения UniFarm в продакшене.

## Обзор системы статуса

Страница статуса предоставляет визуальный интерфейс для мониторинга ключевых компонентов UniFarm:
- Состояние соединения с базой данных
- Статус Telegram бота
- Системные метрики (память, время работы)
- История событий базы данных

## Доступ к странице статуса

Страница статуса доступна по адресу:
```
https://ваш-домен.com/status
```

Она автоматически обновляется каждые 30 секунд для отображения актуальной информации.

## Интерпретация показателей

### Статус базы данных

- **connected** (зеленый) - Соединение с основной БД установлено и работает
- **reconnecting** (желтый) - Идет попытка восстановления соединения
- **memory_fallback** (фиолетовый) - Используется резервное in-memory хранилище
- **disconnected** (красный) - Все соединения недоступны

### Статус Telegram бота

- **online** (зеленый) - Бот инициализирован и webhook настроен
- **offline** (красный) - Бот не инициализирован или произошла ошибка

### События базы данных

В таблице событий отображается история последних изменений состояния базы данных, включая:
- Время события
- Тип события
- Сообщение события

## Обслуживание и устранение неполадок

### Возможные проблемы и решения

1. **Страница статуса не загружается**
   - Проверьте, запущено ли приложение
   - Убедитесь, что маршрут `/status` доступен в конфигурации сервера

2. **Статус базы данных "disconnected" или "memory_fallback"**
   - Проверьте подключение к базе данных
   - Используйте административный API (`/api/db/reconnect`) для попытки восстановления соединения

3. **Статус Telegram бота "offline"**
   - Проверьте наличие токена бота в переменных окружения
   - Убедитесь, что webhook URL настроен правильно
   - Перезапустите приложение для повторной инициализации бота

### Регулярное обслуживание

Рекомендуется регулярно проверять страницу статуса для:
- Мониторинга использования памяти и предотвращения утечек
- Выявления проблем с соединением до того, как они повлияют на пользователей
- Отслеживания времени непрерывной работы для планирования обслуживания

## Расширение функциональности

Страница статуса может быть расширена для отображения дополнительной информации:

1. Добавьте новые метрики в функцию `statusPageHandler` в файле `server/utils/status-page.ts`
2. Обновите HTML-шаблон в функции `generateStatusHtml` для отображения новых метрик
3. При необходимости добавьте новые типы событий в `DatabaseEventType` в файле `server/utils/db-events.ts`

## Интеграция с системами мониторинга

Для интеграции с внешними системами мониторинга, используйте API-эндпоинт:
```
GET /api/health
```

Этот эндпоинт возвращает JSON с текущим состоянием всех компонентов системы и может использоваться для настройки автоматических оповещений.